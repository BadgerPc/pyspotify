<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>libspotify: search.c</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>search.c</h1>The search.c example shows how you can use search functions. It is part of the spshell program<p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="preprocessor">#include "spshell.h"</span>
<span class="preprocessor">#include "cmd.h"</span>


<span class="keyword">static</span> <span class="keywordtype">void</span> print_album(<a name="a0"></a><a class="code" href="group__types.html#g6fd3e5de729c429fef3ff18ece6dcfad" title="An album handle.">sp_album</a> *album)
{
    printf(<span class="stringliteral">"  Album \"%s\" (%d)\n"</span>,
           <a name="a1"></a><a class="code" href="group__album.html#g0e828c991a8184d60026513f944e19ad">sp_album_name</a>(album),
           <a name="a2"></a><a class="code" href="group__album.html#g2aadf934b0af43c3ef6ee98b6a8065fd">sp_album_year</a>(album));
}

<span class="keyword">static</span> <span class="keywordtype">void</span> print_artist(<a name="a3"></a><a class="code" href="group__types.html#g31764fbd69618c10be173c6c03d4c1bc" title="An artist handle.">sp_artist</a> *artist)
{
    printf(<span class="stringliteral">"  Artist \"%s\"\n"</span>, <a name="a4"></a><a class="code" href="group__artist.html#gd2895555bb48514986823733a7afe5e2">sp_artist_name</a>(artist));
}

<span class="keyword">static</span> <span class="keywordtype">void</span> print_search(<a name="a5"></a><a class="code" href="group__types.html#gc95893a6b23d4b19f6f149eed6ead1fd" title="A handle to a search result.">sp_search</a> *search)
{
    <span class="keywordtype">int</span> i;

    printf(<span class="stringliteral">"Query          : %s\n"</span>, <a name="a6"></a><a class="code" href="group__search.html#g127e9c2bf98e3602ecfc2926b9d242bf">sp_search_query</a>(search));
    printf(<span class="stringliteral">"Did you mean   : %s\n"</span>, <a name="a7"></a><a class="code" href="group__search.html#g8561c1da8b93ecdc8f2d325a9d19199b">sp_search_did_you_mean</a>(search));
    printf(<span class="stringliteral">"Tracks in total: %d\n"</span>, <a name="a8"></a><a class="code" href="group__search.html#gb4e50582c517b4639fd1afd6fb011587">sp_search_total_tracks</a>(search));
    puts(<span class="stringliteral">""</span>);

    <span class="keywordflow">for</span> (i = 0; i &lt; <a name="a9"></a><a class="code" href="group__search.html#g1dd18cf7b3b3b7f4bf6e92a2140378d0">sp_search_num_tracks</a>(search); ++i)
        print_track(<a name="a10"></a><a class="code" href="group__search.html#ge9da7ca59ce0bbd73f7bcef4e15c4da8">sp_search_track</a>(search, i));

    puts(<span class="stringliteral">""</span>);

    <span class="keywordflow">for</span> (i = 0; i &lt; <a name="a11"></a><a class="code" href="group__search.html#g0c456a6396c4c05fbc8677ea641ef1f7">sp_search_num_albums</a>(search); ++i)
        print_album(<a name="a12"></a><a class="code" href="group__search.html#g4ba7723e70db0c6a4569c4bcd44f0e98">sp_search_album</a>(search, i));

    puts(<span class="stringliteral">""</span>);

    <span class="keywordflow">for</span> (i = 0; i &lt; <a name="a13"></a><a class="code" href="group__search.html#gbd375a613c2dadecad8c13f8aca6f2d3">sp_search_num_artists</a>(search); ++i)
        print_artist(<a name="a14"></a><a class="code" href="group__search.html#g79b3d532d5a20a3b2bf2a087eead7888">sp_search_artist</a>(search, i));

    puts(<span class="stringliteral">""</span>);
}

<span class="keyword">static</span> <span class="keywordtype">void</span> search_complete(<a class="code" href="group__types.html#gc95893a6b23d4b19f6f149eed6ead1fd" title="A handle to a search result.">sp_search</a> *search, <span class="keywordtype">void</span> *userdata)
{
    <span class="keywordflow">if</span> (<a name="a15"></a><a class="code" href="group__search.html#g7cf655e37a823f952d30270d4fb60f10">sp_search_error</a>(search) == <a name="a16"></a><a class="code" href="group__error.html#ggfd27986ce4cd9eeaeca8adda83c9eb6b16cb277dc84328e4b2c0cf6d5a0c0b8d" title="No errors encountered.">SP_ERROR_OK</a>)
        print_search(search);
    <span class="keywordflow">else</span>
        fprintf(stderr, <span class="stringliteral">"Failed to search: %s\n"</span>,
                <a name="a17"></a><a class="code" href="group__error.html#g983dee341d3c2008830513b7cffe7bf3">sp_error_message</a>(<a class="code" href="group__search.html#g7cf655e37a823f952d30270d4fb60f10">sp_search_error</a>(search)));

    <a name="a18"></a><a class="code" href="group__search.html#g5a5bcc9cf18698774a099c3ce8cdab63">sp_search_release</a>(search);
    cmd_done();
}



<span class="keyword">static</span> <span class="keywordtype">void</span> search_usage(<span class="keywordtype">void</span>)
{
    fprintf(stderr, <span class="stringliteral">"Usage: search &lt;query&gt;\n"</span>);
}


<span class="keywordtype">int</span> cmd_search(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    <span class="keywordtype">char</span> query[1024];
    <span class="keywordtype">int</span> i;

    <span class="keywordflow">if</span> (argc &lt; 2) {
        search_usage();
        <span class="keywordflow">return</span> -1;
    }

    query[0] = 0;
    <span class="keywordflow">for</span>(i = 1; i &lt; argc; i++)
        snprintf(query + strlen(query), <span class="keyword">sizeof</span>(query) - strlen(query), <span class="stringliteral">"%s%s"</span>,
             i == 1 ? <span class="stringliteral">""</span> : <span class="stringliteral">" "</span>, argv[i]);

    <a name="a19"></a><a class="code" href="group__search.html#gcf0b5e902e27d46ef8b1f40e332766df">sp_search_create</a>(g_session, query, 0, 100, 0, 100, 0, 100, &amp;search_complete, NULL);
    <span class="keywordflow">return</span> 0;
}


<span class="keywordtype">int</span> cmd_whatsnew(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    <a class="code" href="group__search.html#gcf0b5e902e27d46ef8b1f40e332766df">sp_search_create</a>(g_session, <span class="stringliteral">"tag:new"</span>, 0, 0, 0, 250, 0, 0, &amp;search_complete, NULL);
    <span class="keywordflow">return</span> 0;
}



<span class="keyword">struct </span>{
    <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
    <a class="code" href="group__search.html#g4a1552ce40b390e21d798bbba13e231b">sp_radio_genre</a> id;
} radiogenres[] = {
    { <span class="stringliteral">"AltPopRock"</span>,     SP_RADIO_GENRE_ALT_POP_ROCK },
    { <span class="stringliteral">"Blues"</span>,          SP_RADIO_GENRE_BLUES        },
    { <span class="stringliteral">"Country"</span>,        SP_RADIO_GENRE_COUNTRY      },
    { <span class="stringliteral">"Disco"</span>,          SP_RADIO_GENRE_DISCO        },
    { <span class="stringliteral">"Funk"</span>,           SP_RADIO_GENRE_FUNK         },
    { <span class="stringliteral">"Hardrock"</span>,       SP_RADIO_GENRE_HARD_ROCK    },
    { <span class="stringliteral">"HeavyMetal"</span>,     SP_RADIO_GENRE_HEAVY_METAL  },
    { <span class="stringliteral">"Rap"</span>,            SP_RADIO_GENRE_RAP          },
    { <span class="stringliteral">"House"</span>,          SP_RADIO_GENRE_HOUSE        },
    { <span class="stringliteral">"Jazz"</span>,           SP_RADIO_GENRE_JAZZ         },
    { <span class="stringliteral">"NewWave"</span>,        SP_RADIO_GENRE_NEW_WAVE     },
    { <span class="stringliteral">"RnB"</span>,            SP_RADIO_GENRE_RNB          },
    { <span class="stringliteral">"Pop"</span>,            SP_RADIO_GENRE_POP          },
    { <span class="stringliteral">"Punk"</span>,           SP_RADIO_GENRE_PUNK         },
    { <span class="stringliteral">"Reggae"</span>,         SP_RADIO_GENRE_REGGAE       },
    { <span class="stringliteral">"PopRock"</span>,        SP_RADIO_GENRE_POP_ROCK     },
    { <span class="stringliteral">"Soul"</span>,           SP_RADIO_GENRE_SOUL         },
    { <span class="stringliteral">"Techno"</span>,         SP_RADIO_GENRE_TECHNO       },
};



<span class="keyword">static</span> <span class="keywordtype">void</span> radio_usage(<span class="keywordtype">void</span>)
{
    <span class="keywordtype">int</span> i;
    fprintf(stderr, <span class="stringliteral">"Usage: radio &lt;startyear&gt; &lt;stopyear&gt; [&lt;genre&gt; ...]\n"</span>);
    fprintf(stderr, <span class="stringliteral">"  Genres:\n"</span>);
    <span class="keywordflow">for</span>(i = 0; i &lt; <span class="keyword">sizeof</span>(radiogenres) / <span class="keyword">sizeof</span>(radiogenres[0]); i++)
        fprintf(stderr, <span class="stringliteral">"\t%s\n"</span>, radiogenres[i].name);
}

<span class="keywordtype">int</span> cmd_radio(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    <a class="code" href="group__search.html#g4a1552ce40b390e21d798bbba13e231b">sp_radio_genre</a> mask = 0;
    <span class="keywordtype">int</span> i, j;

    <span class="keywordflow">if</span> (argc &lt; 3) {
        radio_usage();
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">for</span>(i = 3; i &lt; argc; i++)
        <span class="keywordflow">for</span>(j = 0; j &lt; <span class="keyword">sizeof</span>(radiogenres) / <span class="keyword">sizeof</span>(radiogenres[0]); j++)
            <span class="keywordflow">if</span> (!strcasecmp(radiogenres[j].name, argv[i]))
                mask |= radiogenres[j].<span class="keywordtype">id</span>;

    <a name="a20"></a><a class="code" href="group__search.html#gdb7d2f6845e5efc49afa6e83ca14b014">sp_radio_search_create</a>(g_session, atoi(argv[1]), atoi(argv[2]), mask, &amp;search_complete, NULL);
    <span class="keywordflow">return</span> 0;
}
</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Fri Apr 23 06:19:05 2010.<br>
Copyright &copy; 2006&ndash;2010 Spotify Ltd</small></address>
</body>
</html>
